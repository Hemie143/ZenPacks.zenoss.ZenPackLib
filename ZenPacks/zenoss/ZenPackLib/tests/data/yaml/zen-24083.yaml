name: ZenPacks.community.TestDEFAULSonDatasource

device_classes:
  /Device:
    templates:
      TESTAGGPASS:
        description: you should see that targetDatsource sets correctly
        datasources:
          # THESE defaults arent working so set manually below remove when fixed
          DEFAULTS:
            type: Datapoint Aggregator
            eventClass: /App/Zenoss
            component: "${here/id}"
          agg_out_octets:
            type: Datapoint Aggregator
            targetDataSource: ethernetcmascd_64
            targetDataPoint: ifHCOutOctets
            targetMethod: os.interfaces
            datapoints:
              aggifHCOutOctets:
                operation: sum
          agg_in_octets:
            type: Datapoint Aggregator
            targetDataSource: ethernetcmascd_64
            targetDataPoint: ifHCInOctets
            targetMethod: os.interfaces
            datapoints:
              aggifHCInOctets:
                operation: sum
        graphs:
          DEFAULTS:
            width: 1000
            miny: -100
            maxy: 100
            units: oct per sec
          Aggregated Octets:
            graphpoints:
              RX:
                dpName: agg_out_octets_aggifHCOutOctets
              TX:
                dpName: agg_in_octets_aggifHCInOctets

      TESTAGGFAIL:
        description: you should see that targetDatsource does not set
        datasources:
          # THESE defaults arent working so set manually below remove when fixed
          DEFAULTS:
            type: Datapoint Aggregator
            eventClass: /App/Zenoss
            component: "${here/id}"
            targetDataSource: ethernetcmascd_64
            targetDataPoint: ifHCOutOctets
            targetMethod: os.interfaces
          agg_out_octets:
            datapoints:
              aggifHCOutOctets:
                operation: sum
          agg_in_octets:
            datapoints:
              aggifHCInOctets:
                operation: sum
        thresholds:
          TEST:
            dsnames: [agg_out_octets_aggifHCOutOctets]
            eventClass: /Perf
            severity: crit
            minval: -100
            maxval: 100
        graphs:
          DEFAULTS:
            width: 1000
            miny: 0
            units: oct per sec
          Aggregated Octets:
            graphpoints:
              RX:
                dpName: agg_out_octets_aggifHCOutOctets
              TX:
                dpName: agg_in_octets_aggifHCInOctets
